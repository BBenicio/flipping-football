[gd_scene load_steps=3 format=1]

[ext_resource path="res://Themes/Menu.tres" type="Theme" id=1]

[sub_resource type="GDScript" id=1]

script/source = "extends ScrollContainer

export var rows = 20

var rowScene = preload(\"res://Objects/ClassificationRow.tscn\")
var rowList = []

var list = null

func _ready():
	list = get_node(\"List\")

	var title = rowScene.instance()
	list.add_child(title)
	title.setNodeText(\"Position\", \"\")
	title.setNodeText(\"TeamName\", \"\")
	title.setNodeText(\"Points\", \"P\")
	title.setNodeText(\"Wins\", \"W\")
	title.setNodeText(\"Draws\", \"D\")
	title.setNodeText(\"Losses\", \"L\")
	title.setNodeText(\"GoalDifference\", \"GD\")

	for i in range(rows):
		var r = rowScene.instance()

		r.position = i + 1
		rowList.append(r)

		list.add_child(r)

	useArray(Globals.get(\"league/table\"))


	sort()

func sort():
	rowList.sort_custom(self, \"compare\")

	var table = Globals.get(\"league/table\")

	for i in range(rowList.size()):
		rowList[i].position = i + 1
		list.move_child(rowList[i], i + 1)
		table[i][0] = i + 1
		table[i][1] = rowList[i].teamName
		table[i][2] = rowList[i].points
		table[i][3] = rowList[i].wins
		table[i][4] = rowList[i].draws
		table[i][5] = rowList[i].losses
		table[i][6] = rowList[i].goalDifference
		table[i][7] = rowList[i].id

	Globals.set(\"league/table\", table)
	rowList.sort_custom(self, \"idSort\")

	Globals.save()

func idSort(a, b):
	return a.id < b.id

func compare(a, b):
	if a.points != b.points:
		return a.points > b.points
	elif a.goalDifference != b.goalDifference:
		return a.goalDifference > b.goalDifference
	elif a.wins != b.wins:
		return a.wins > b.points
	elif a.draws != b.draws:
		return a.draws > b.draws
	elif a.losses != b.losses:
		return a.losses < b.losses
	else:
		return a.position < b.position

func getRow(i):
	return rowList[i]

func useArray(table):
	for i in range(table.size()):
		rowList[i].useArray(table[i])"

[node name="ClassificationTable" type="ScrollContainer"]

focus/ignore_mouse = false
focus/stop_mouse = true
size_flags/horizontal = 2
size_flags/vertical = 2
theme/theme = ExtResource( 1 )
margin/left = 0.0
margin/top = 0.0
margin/right = 1000.0
margin/bottom = 900.0
scroll/horizontal = false
scroll/vertical = true
script/script = SubResource( 1 )
rows = 20

[node name="List" type="VBoxContainer" parent="."]

focus/ignore_mouse = false
focus/stop_mouse = false
size_flags/horizontal = 2
size_flags/vertical = 2
margin/left = 0.0
margin/top = 0.0
margin/right = 0.0
margin/bottom = 0.0
custom_constants/separation = -1
alignment = 0


